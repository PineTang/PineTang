---
title: 非装饰器实现一个请求重试模块
date: 2021-12-06 18:20:22
tags: [Python]
categories: Python
---

## 通过反射和无名参数实现
> 代码
```python
import requests

def retryRequest(req_type='get', retry_type=1, **kwargs):
    '''
    req_type: 请求类型  get/post
    retry_type: 重试次数， >=1时按传参次数；==0时开启无限重试至成功
    kwargs: 不定数量动态参数
    '''
    print(kwargs)

    def try_except(req_type, **kwargs):
        try:
            response = getattr(requests, req_type)(**kwargs)  # 通过反射动态调用函数
            if response.status_code == 200: return response, True
            else: return response, False  # 非 200 响应，则继续重试
        except Exception as e:
            try:
                print(e, response)
            except:
                response = "requests 请求未完成"
                print(e, response)
            return response, False

    if retry_type:
        for i in range(retry_type):
            response, req_statu = try_except(req_type, **kwargs)
            if req_statu: break
            time.sleep(1)
    else:
        while True:
            response, req_statu = try_except(req_type, **kwargs)
            if req_statu: break
            time.sleep(1)

    return response


```