---
title: 某音19.7抓包记录
date: 2022-03-07 18:01:05
tags: [App逆向]
categories: 反爬, 抓包
---


## 参考文章
[看雪大佬文章](https://bbs.pediy.com/thread-269028.htm)

## 动手分析 so
> 先把目标 so 文件提取出来

```shell
adb shell
su

# tab 键按一下自动补全路径
cd /data/app/com.ss.android.ugc.aweme-Cw2jdoMNzzZKhzLDxO3bNA==/lib/arm
# 拷贝一下文件
cp libsscronet.so /sdcard/douyin197lib/
# 退出 adb ， 然后 pull 到 pc
adb pull /data/app/com.ss.android.ugc.aweme-Cw2jdoMNzzZKhzLDxO3bNA==/lib/arm/libsscronet.so 
```

## 使用 IDA 分析并修改 so
### 等待反编译完成，然后搜索关键字
>时间有一点久，一定要等待全部完成
然后搜索所关键字 `SSL_CTX_set_custom_verify`

![img](https://gitee.com/PineKer/myfiles/raw/master/blog/2022031009433_1.png)

![img](https://gitee.com/PineKer/myfiles/raw/master/blog/2022031009433_2.png)

### 分析代码

> tab 一下查看反编译代码

![img](https://gitee.com/PineKer/myfiles/raw/master/blog/2022031009433_3.png)

> 点进来后，看到有两个地方做了 return，第一个看起来应该是 ssl 验证;
> 第二个 return 是个函数，需要进去分析；

### 修改返回值

> 根据大佬的文章，`经过查阅发现 返回值为0的时候才是 ssl_verify_ok`
> 所以先动手将第一个改了，鼠标放在 1 上，然后选择工具栏 `view -> Open subviews -> Hex dump`

![img](https://gitee.com/PineKer/myfiles/raw/master/blog/2022031009433_4.png)

![img](https://gitee.com/PineKer/myfiles/raw/master/blog/2022031009433_5.png)

![img](https://gitee.com/PineKer/myfiles/raw/master/blog/2022031009433_6.png)

![img](https://gitee.com/PineKer/myfiles/raw/master/blog/2022031009433_7.png)

> 接下来，看第二个 return 是个函数，点进去

![img](https://gitee.com/PineKer/myfiles/raw/master/blog/2022031009433_8.png)

> 这个函数有四个return，需要一一更改，最后一个 result 本身就是 0 ，就不改了
> 其他三处地方按照上边的方式改成 0

![img](https://gitee.com/PineKer/myfiles/raw/master/blog/2022031009433_9.png)

### 导出

> 然后导出,直接输出就ok了

![img](https://gitee.com/PineKer/myfiles/raw/master/blog/2022031009433_10.png)
## 替换 so
```shell
# 将修改过的传到手机
adb push libsscronet.so /sdcard

adb shell
su
cd /data/app/com.ss.android.ugc.aweme-Cw2jdoMNzzZKhzLDxO3bNA==/lib/arm/
cp /sdcard/libsscronet.so 

chgrp system libsscronet.so
chown system libsscronet.so
chmod 777 libsscronet.so

```

## 现在就可以用抓包工具抓包了

![img](https://gitee.com/PineKer/myfiles/raw/master/blog/2022031009433_11.png)

## 如果还是没抓到就去找个脚本 关一下 sslpinning